---
- name: "Install testfluskapp"
  become: yes
  hosts: [proddeploy]
  vars:
    DOCKER_USERNAME: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          39353639346261653361643939636633313635613465313232653261383732643362303132346631
          6262636138373536666135346631313465643338333464610a656464356636666461326366336262
          34353835643739343661383866376132306234383438343731633462623164393431616161613234
          6131643634373261640a363839303938623466393638666162623236356436363663643735633836
          3232
    DOCKERHUB_PASSWORD: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          393733613 23438393563383162306132633634326639323931343463663232633662373561383163
          3864343665633438366166663464303038313031326661340a343732386466316137313637633438
          39303037663962313833393863333633373332663865323538376534656563636237333731306563
          6465316332383762300a646435313561353063323765643961303863353034656438383433383630
          3833
  tasks:
    - name: Stop and Delete Running testfluskapp_prod container
      docker_container:
        name: testfluskapp_prod
        state: absent
    - name: Remove testfluskapp_prod Image 
      docker_image:
        name: kirilljbee/testfluskapp:prod
        state: absent
    - name: Log into DockerHub
      docker_login:
        username: "{{ DOCKER_USERNAME }}"
        password: "{{ DOCKERHUB_PASSWORD }}"
    # - name: Pull testfluskapp:latest Docker container
    #   docker_image:
    #     name: kirilljbee/testfluskapp:prod
    #     source: pull
    - name: Pull and Run testfluskapp:latest Docker container
      docker_container:
        name: testfluskapp_prod
        image: kirilljbee/testfluskapp:prod
        state: started
        ports:
          - "8000:8000"
    